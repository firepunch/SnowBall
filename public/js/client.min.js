function searchKeyPress(a){return a=a||window.event,13!=a.keyCode||(document.getElementById("play").click(),!1)}function submitNick(){document.getElementById("loginDiv").style.display="none",document.getElementById("gameAreaWrapper").style.display="flex",startSocket(),cancelAniFrame(introAnimationID)}function initballs_intro(){balls_intro=[];var a="#13073A",b="#4E4E4F";return balls_intro.push(new Ball(64,12,0,0,a)),balls_intro.push(new Ball(76,12,0,0,a)),balls_intro.push(new Ball(88,12,0,0,a)),balls_intro.push(new Ball(412,12,0,0,a)),balls_intro.push(new Ball(580,12,0,0,a)),balls_intro.push(new Ball(616,12,0,0,a)),balls_intro.push(new Ball(688,12,0,0,b)),balls_intro.push(new Ball(40,24,0,0,a)),balls_intro.push(new Ball(52,24,0,0,a)),balls_intro.push(new Ball(88,24,0,0,a)),balls_intro.push(new Ball(412,24,0,0,a)),balls_intro.push(new Ball(580,24,0,0,a)),balls_intro.push(new Ball(616,36,0,0,a)),balls_intro.push(new Ball(40,48,0,0,a)),balls_intro.push(new Ball(124,48,0,0,a)),balls_intro.push(new Ball(136,48,0,0,a)),balls_intro.push(new Ball(148,48,0,0,a)),balls_intro.push(new Ball(160,48,0,0,a)),balls_intro.push(new Ball(172,48,0,0,a)),balls_intro.push(new Ball(220,48,0,0,a)),balls_intro.push(new Ball(232,48,0,0,a)),balls_intro.push(new Ball(244,48,0,0,a)),balls_intro.push(new Ball(258,48,0,0,a)),balls_intro.push(new Ball(292,48,0,0,a)),balls_intro.push(new Ball(340,48,0,0,a)),balls_intro.push(new Ball(388,48,0,0,a)),balls_intro.push(new Ball(412,48,0,0,a)),balls_intro.push(new Ball(424,48,0,0,a)),balls_intro.push(new Ball(436,48,0,0,a)),balls_intro.push(new Ball(448,48,0,0,a)),balls_intro.push(new Ball(460,48,0,0,a)),balls_intro.push(new Ball(496,48,0,0,a)),balls_intro.push(new Ball(508,48,0,0,a)),balls_intro.push(new Ball(520,48,0,0,a)),balls_intro.push(new Ball(532,48,0,0,a)),balls_intro.push(new Ball(580,48,0,0,a)),balls_intro.push(new Ball(616,48,0,0,a)),balls_intro.push(new Ball(688,48,0,0,b)),balls_intro.push(new Ball(736,48,0,0,b)),balls_intro.push(new Ball(748,48,0,0,b)),balls_intro.push(new Ball(760,48,0,0,b)),balls_intro.push(new Ball(772,48,0,0,b)),balls_intro.push(new Ball(52,60,0,0,a)),balls_intro.push(new Ball(64,60,0,0,a)),balls_intro.push(new Ball(124,60,0,0,a)),balls_intro.push(new Ball(172,60,0,0,a)),balls_intro.push(new Ball(208,60,0,0,a)),balls_intro.push(new Ball(268,60,0,0,a)),balls_intro.push(new Ball(292,60,0,0,a)),balls_intro.push(new Ball(328,60,0,0,a)),balls_intro.push(new Ball(340,60,0,0,a)),balls_intro.push(new Ball(376,60,0,0,a)),balls_intro.push(new Ball(412,60,0,0,a)),balls_intro.push(new Ball(460,60,0,0,a)),balls_intro.push(new Ball(472,60,0,0,a)),balls_intro.push(new Ball(544,60,0,0,a)),balls_intro.push(new Ball(580,60,0,0,a)),balls_intro.push(new Ball(616,60,0,0,a)),balls_intro.push(new Ball(688,60,0,0,b)),balls_intro.push(new Ball(724,60,0,0,a)),balls_intro.push(new Ball(772,60,0,0,a)),balls_intro.push(new Ball(64,72,0,0,a)),balls_intro.push(new Ball(616,60,0,0,a)),balls_intro.push(new Ball(724,60,0,0,b)),balls_intro.push(new Ball(772,60,0,0,b)),balls_intro.push(new Ball(64,72,0,0,a)),balls_intro.push(new Ball(76,72,0,0,a)),balls_intro.push(new Ball(88,72,0,0,a)),balls_intro.push(new Ball(124,72,0,0,a)),balls_intro.push(new Ball(172,72,0,0,a)),balls_intro.push(new Ball(208,72,0,0,a)),balls_intro.push(new Ball(268,72,0,0,a)),balls_intro.push(new Ball(292,72,0,0,a)),balls_intro.push(new Ball(304,72,0,0,a)),balls_intro.push(new Ball(328,72,0,0,a)),balls_intro.push(new Ball(352,72,0,0,a)),balls_intro.push(new Ball(376,72,0,0,a)),balls_intro.push(new Ball(412,72,0,0,a)),balls_intro.push(new Ball(472,72,0,0,a)),balls_intro.push(new Ball(532,72,0,0,a)),balls_intro.push(new Ball(544,72,0,0,a)),balls_intro.push(new Ball(580,72,0,0,a)),balls_intro.push(new Ball(616,72,0,0,a)),balls_intro.push(new Ball(688,72,0,0,b)),balls_intro.push(new Ball(712,72,0,0,b)),balls_intro.push(new Ball(724,72,0,0,b)),balls_intro.push(new Ball(784,72,0,0,b)),balls_intro.push(new Ball(88,84,0,0,b)),balls_intro.push(new Ball(124,84,0,0,a)),balls_intro.push(new Ball(172,84,0,0,a)),balls_intro.push(new Ball(208,84,0,0,a)),balls_intro.push(new Ball(268,84,0,0,a)),balls_intro.push(new Ball(304,84,0,0,a)),balls_intro.push(new Ball(328,84,0,0,a)),balls_intro.push(new Ball(352,84,0,0,a)),balls_intro.push(new Ball(376,84,0,0,a)),balls_intro.push(new Ball(412,84,0,0,a)),balls_intro.push(new Ball(472,84,0,0,a)),balls_intro.push(new Ball(496,84,0,0,a)),balls_intro.push(new Ball(508,84,0,0,a)),balls_intro.push(new Ball(544,84,0,0,a)),balls_intro.push(new Ball(580,84,0,0,a)),balls_intro.push(new Ball(616,84,0,0,a)),balls_intro.push(new Ball(688,84,0,0,b)),balls_intro.push(new Ball(712,84,0,0,b)),balls_intro.push(new Ball(784,84,0,0,b)),balls_intro.push(new Ball(88,84,0,0,a)),balls_intro.push(new Ball(124,84,0,0,a)),balls_intro.push(new Ball(172,84,0,0,a)),balls_intro.push(new Ball(208,84,0,0,a)),balls_intro.push(new Ball(268,84,0,0,a)),balls_intro.push(new Ball(304,96,0,0,a)),balls_intro.push(new Ball(316,96,0,0,a)),balls_intro.push(new Ball(352,96,0,0,a)),balls_intro.push(new Ball(364,96,0,0,a)),balls_intro.push(new Ball(412,96,0,0,a)),balls_intro.push(new Ball(460,96,0,0,a)),balls_intro.push(new Ball(472,96,0,0,a)),balls_intro.push(new Ball(496,96,0,0,a)),balls_intro.push(new Ball(544,96,0,0,a)),balls_intro.push(new Ball(580,96,0,0,a)),balls_intro.push(new Ball(616,96,0,0,a)),balls_intro.push(new Ball(688,96,0,0,b)),balls_intro.push(new Ball(724,96,0,0,b)),balls_intro.push(new Ball(772,96,0,0,b)),balls_intro.push(new Ball(784,96,0,0,b)),balls_intro.push(new Ball(40,108,0,0,a)),balls_intro.push(new Ball(76,108,0,0,a)),balls_intro.push(new Ball(88,108,0,0,a)),balls_intro.push(new Ball(124,108,0,0,a)),balls_intro.push(new Ball(172,108,0,0,a)),balls_intro.push(new Ball(208,108,0,0,a)),balls_intro.push(new Ball(220,108,0,0,a)),balls_intro.push(new Ball(256,108,0,0,a)),balls_intro.push(new Ball(304,108,0,0,a)),balls_intro.push(new Ball(316,108,0,0,a)),balls_intro.push(new Ball(352,108,0,0,a)),balls_intro.push(new Ball(364,108,0,0,a)),balls_intro.push(new Ball(412,108,0,0,a)),balls_intro.push(new Ball(424,108,0,0,a)),balls_intro.push(new Ball(460,108,0,0,a)),balls_intro.push(new Ball(496,108,0,0,a)),balls_intro.push(new Ball(532,108,0,0,a)),balls_intro.push(new Ball(544,108,0,0,a)),balls_intro.push(new Ball(580,108,0,0,a)),balls_intro.push(new Ball(616,108,0,0,a)),balls_intro.push(new Ball(652,108,0,0,b)),balls_intro.push(new Ball(688,108,0,0,b)),balls_intro.push(new Ball(724,108,0,0,b)),balls_intro.push(new Ball(736,108,0,0,b)),balls_intro.push(new Ball(772,108,0,0,b)),balls_intro.push(new Ball(52,120,0,0,a)),balls_intro.push(new Ball(64,120,0,0,a)),balls_intro.push(new Ball(76,120,0,0,a)),balls_intro.push(new Ball(232,120,0,0,a)),balls_intro.push(new Ball(244,120,0,0,a)),balls_intro.push(new Ball(436,120,0,0,a)),balls_intro.push(new Ball(448,120,0,0,a)),balls_intro.push(new Ball(508,120,0,0,a)),balls_intro.push(new Ball(502,120,0,0,a)),balls_intro.push(new Ball(652,120,0,0,b)),balls_intro.push(new Ball(736,120,0,0,b)),balls_intro.push(new Ball(748,120,0,0,b)),balls_intro.push(new Ball(760,120,0,0,b)),balls_intro}function getMousePos(a,b){for(var c=a,d=0,e=0;"BODY"!=c.tagName;)d+=c.offsetTop,e+=c.offsetLeft,c=c.offsetParent;var f=b.clientX-e+window.pageXOffset,g=b.clientY-d+window.pageYOffset;return{x:f,y:g}}function updateballs_intro(a,b,c,d){for(var f=(a.getContext("2d"),.3),g=5e-4*c,h=1*c,i=.002*c,j=0;j<b.length;j++){var k=b[j];k.y+=k.vy,k.x+=k.vx,k.x>k.origX?k.vx-=i:k.vx+=i,k.y>k.origY?k.vy-=i:k.vy+=i;var l=d.x,m=d.y,n=k.x-l,o=k.y-m,p=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),q=Math.abs(n)+Math.abs(o),r=Math.abs(n)/q*(1/p)*h,s=Math.abs(o)/q*(1/p)*h;n>0?k.vx+=r:k.vx-=r,o>0?k.vy+=s:k.vy-=s,k.vx>0?k.vx-=g:k.vx<0&&(k.vx+=g),k.vy>0?k.vy-=g:k.vy<0&&(k.vy+=g),k.y>a.height-k.radius&&(k.y=a.height-k.radius-2,k.vy*=-1,k.vy*=1-f),k.y<k.radius&&(k.y=k.radius+2,k.vy*=-1,k.vy*=1-f),k.x>a.width-k.radius&&(k.x=a.width-k.radius-2,k.vx*=-1,k.vx*=1-f),k.x<k.radius&&(k.x=k.radius+2,k.vx*=-1,k.vx*=1-f)}}function Ball(a,b,c,d,e){this.x=a,this.y=b,this.vx=c,this.vy=d,this.color=e,this.origX=a,this.origY=b,this.radius=10}function animate(a,b,c,d){var e=loginCanvas.getContext("2d"),f=new Date,g=f.getTime(),h=g-c;updateballs_intro(loginCanvas,b,h,d),c=g,e.clearRect(0,0,loginCanvas.width,loginCanvas.height);for(var i=0;i<b.length;i++){var j=b[i];e.beginPath(),e.arc(j.x,j.y,j.radius,0,2*Math.PI,!1),e.fillStyle=j.color,e.fill()}introAnimationID=requestAnimFrame(function(){animate(loginCanvas,b,c,d)})}function startSocket(){function a(){function a(){drawMap(player);for(var b=0;b<players.length;b++)drawPlayer(players[b]);drawMyPlayer(player),drawScoreBar(player);for(var b=0;b<ballArr.length;b++)drawBall(ballArr[b]);dieEffecte(),dieScreen(),drawTower(),drawScore(),drawLeaderBoard(),drawMiniMap(),SnowDraw(),requestAnimFrame(a)}startEvent(),a()}socket=io({transports:["websocket"]}),socket.on("connected",()=>{window.localStorage&&(localStorage.nick=nick.value),socket.emit("nickName",nick.value)}),socket.on("gameStart",b=>{this.player=b,a()}),socket.on("update",(a,b,c)=>{player=a,players=b,ballArr=c}),socket.on("updateDeath",(a,b)=>{players=a,ballArr=b}),socket.on("die",a=>{document.getElementById("NAME").innerHTML="name : "+a.name,document.getElementById("SCORE").innerHTML="score : "+a.score,document.getElementById("LEVEL").innerHTML="level : "+a.level,document.getElementById("MAXHP").innerHTML="maxhp : "+a.MAXHP,document.getElementById("SPEED").innerHTML="speed : "+a.SPEED,document.getElementById("THROWPOWER").innerHTML="throw power : "+a.THROWPOWER,document.getElementById("MAXBALLCOUNT").innerHTML="max ball count : "+a.MAXBALLCOUNT,document.getElementById("BALLDEMAGE").innerHTML="ball demage : "+a.BALLDEMAGE,document.getElementById("BALLHP").innerHTML="ball hp : "+a.BALLHP,document.getElementById("JUMPDEMAGE").innerHTML="jump demage : "+a.JUMPDEMAGE,death=!0,document.getElementById("dieWrapper").style.display="flex"}),socket.on("revivalOK",()=>{document.getElementById("dieWrapper").style.display="none",document.getElementById("upgradeForm").style.display="none",death=!1}),socket.on("levelUp",a=>{this.skillPoint=a.skillPoint,document.getElementById("maxHp").innerHTML="Max Hp : "+a.maxHp,document.getElementById("speed").innerHTML="Speed : "+a.speed,document.getElementById("throwPower").innerHTML="Throw Power : "+a.throwPower,document.getElementById("maxBallCount").innerHTML="Max Ball Count : "+a.maxBallCount,document.getElementById("balldemage").innerHTML="Ball Demage : "+a.ballDemage,document.getElementById("ballHp").innerHTML="Ball Hp : "+a.ballHp,document.getElementById("jumpDemage").innerHTML="Jump Demage : "+a.jumpDemage,document.getElementById("statContainer").style.display="inline-block",document.getElementById("upgradeForm").style.display="inline-block"}),socket.on("tower",a=>{towers=a}),socket.on("corpsesData",a=>{this.corpseArr=a}),socket.on("topPlayers",a=>{topPlayers=a})}function upgradeEmit(a){socket.emit("upgrade",a),document.getElementById("statContainer").style.display="none"}function startEvent(){canvas.addEventListener("mousemove",function(a){pointX=a.offsetX,pointY=a.offsetY}),canvas.addEventListener("mouseup",function(a){var b={mouseY:pointY,mouseX:pointX+shotOffsetX};death||socket.emit("throwBall",b)}),document.onkeydown=function(a){68===a.keyCode?socket.emit("keyPress",{inputId:"right",state:!0}):65===a.keyCode?socket.emit("keyPress",{inputId:"left",state:!0}):87===a.keyCode&&socket.emit("keyPress",{inputId:"up",state:!0})},document.onkeyup=function(a){68===a.keyCode?socket.emit("keyPress",{inputId:"right",state:!1}):65===a.keyCode?socket.emit("keyPress",{inputId:"left",state:!1}):87===a.keyCode&&socket.emit("keyPress",{inputId:"up",state:!1})}}function drawScoreBar(a){ctx.save(),ctx.fillStyle="rgba(0, 0, 0, 0.8)",ctx.fillRect(canvas.width/4,canvas.height-70,canvas.width/4*2,20),ctx.beginPath(),ctx.arc(canvas.width/4,canvas.height-70+10,10,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(canvas.width/4*3,canvas.height-70+10,10,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.restore(),ctx.save(),ctx.fillStyle="rgb(255, 236, 71)",ctx.fillRect(canvas.width/4,canvas.height-70+2,a.score*(canvas.width/4*2/a.nextLevelScore)-2,16),ctx.beginPath(),ctx.arc(canvas.width/4+2,canvas.height-70+10,8,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(canvas.width/4+a.score*(canvas.width/4*2/a.nextLevelScore)-2,canvas.height-70+10,8,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.restore(),ctx.save(),ctx.textBaseline="middle",ctx.font="900 10pt Arial",ctx.fillStyle="white",ctx.fillText(a.level+" lvl  "+a.score+" / "+a.nextLevelScore,canvas.width/2-ctx.measureText(a.level+" lvl  "+a.score+" / "+a.nextLevelScore).width/2,canvas.height-70+10),ctx.strokeStyle="black",ctx.strokeText(a.level+" lvl  "+a.score+" / "+a.nextLevelScore,canvas.width/2-ctx.measureText(a.level+" lvl  "+a.score+" / "+a.nextLevelScore).width/2,canvas.height-70+10),ctx.restore()}function drawMyPlayer(a){death||(ctx.save(),ctx.shadowBlur=20,ctx.shadowColor="#00e5bb",ctx.font="15px Arial",ctx.fillStyle="rgba(0, 0, 0, 0.8)",ctx.fillRect(a.vLocationX-50,a.locationY-42,100,10),ctx.beginPath(),ctx.arc(a.vLocationX-50,a.locationY-42+5,5,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(a.vLocationX+50,a.locationY-42+5,5,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.fillStyle="#00ff80",ctx.fillRect(a.vLocationX-50,a.locationY-42+1,a.hp*(100/a.maxhp),8),ctx.beginPath(),ctx.arc(a.vLocationX-50+2,a.locationY-42+5,4,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(a.vLocationX-50+a.hp*(100/a.maxhp)-1,a.locationY-42+5,4,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.font="bolder 18px Arial",ctx.shadowBlur=0,ctx.fillText(a.level+"lv "+a.name,a.vLocationX-ctx.measureText(a.level+"lv "+a.name).width/2,a.locationY-52),ctx.strokeText(a.level+"lv "+a.name,a.vLocationX-ctx.measureText(a.level+"lv "+a.name).width/2,a.locationY-52),ctx.shadowBlur=20,ctx.drawImage(skeletonSheet.getSheet(a.ImageIndex),a.vLocationX-32,a.vLocationY-32),ctx.restore())}function drawPlayer(a){ctx.save(),ctx.shadowBlur=20,ctx.shadowColor="red",a.team==this.player.team&&(ctx.shadowColor="blue"),ctx.font="15px Arial",this.player.locationX-670<0?(ctx.fillStyle="rgba(0, 0, 0, 0.8)",ctx.fillRect(a.locationX-50,a.locationY-42,100,10),ctx.beginPath(),ctx.arc(a.locationX-50,a.locationY-42+5,5,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(a.locationX+50,a.locationY-42+5,5,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.fillStyle="red",a.team==this.player.team&&(ctx.fillStyle="blue"),ctx.fillRect(a.locationX-50,a.locationY-42+1,a.hp*(100/a.maxhp),8),ctx.beginPath(),ctx.arc(a.locationX-50+2,a.locationY-42+5,4,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(a.locationX-50+a.hp*(100/a.maxhp)-1,a.locationY-42+5,4,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.font="18px Arial",ctx.shadowBlur=0,ctx.fillText(a.level+"lv "+a.name,a.locationX+50-ctx.measureText(a.level+"lv "+a.name).width,a.locationY-52),ctx.strokeText(a.level+"lv "+a.name,a.locationX+50-ctx.measureText(a.level+"lv "+a.name).width,a.locationY-52),ctx.shadowBlur=20,ctx.drawImage(skeletonSheet.getSheet(a.ImageIndex),a.locationX-32,a.locationY-32)):this.player.locationX+670>3200?(ctx.fillStyle="rgba(0, 0, 0, 0.8)",ctx.fillRect(a.locationX-50-mapWidth+canvas.width,a.locationY-42,100,10),ctx.beginPath(),ctx.arc(a.locationX-50-mapWidth+canvas.width,a.locationY-42+5,5,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(a.locationX+50-mapWidth+canvas.width,a.locationY-42+5,5,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.fillStyle="red",a.team==this.player.team&&(ctx.fillStyle="blue"),ctx.fillRect(a.locationX-50-mapWidth+canvas.width,a.locationY-42+1,a.hp*(100/a.maxhp),8),ctx.beginPath(),ctx.arc(a.locationX-50+2-mapWidth+canvas.width,a.locationY-42+5,4,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(a.locationX-50-mapWidth+canvas.width+a.hp*(100/a.maxhp)-1,a.locationY-42+5,4,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.font="18px Arial",ctx.shadowBlur=0,ctx.fillText(a.level+"lv "+a.name,a.locationX-mapWidth+canvas.width+50-ctx.measureText(a.level+"lv "+a.name).width,a.locationY-52),ctx.strokeText(a.level+"lv "+a.name,a.locationX-mapWidth+canvas.width+50-ctx.measureText(a.level+"lv "+a.name).width,a.locationY-52),ctx.shadowBlur=20,ctx.drawImage(skeletonSheet.getSheet(a.ImageIndex),a.locationX-32-mapWidth+canvas.width,a.locationY-32)):(ctx.fillStyle="rgba(0, 0, 0, 0.8)",ctx.fillRect(a.locationX-50-this.player.locationX+canvas.width/2,a.locationY-42,100,10),ctx.beginPath(),ctx.arc(a.locationX-50-this.player.locationX+canvas.width/2,a.locationY-42+5,5,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(a.locationX+50-this.player.locationX+canvas.width/2,a.locationY-42+5,5,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.fillStyle="red",a.team==this.player.team&&(ctx.fillStyle="blue"),ctx.fillRect(a.locationX-50-this.player.locationX+canvas.width/2,a.locationY-42+1,a.hp*(100/a.maxhp),8),ctx.beginPath(),ctx.arc(a.locationX-50+2-this.player.locationX+canvas.width/2,a.locationY-42+5,4,Math.PI/2,3*Math.PI/2),ctx.fill(),ctx.beginPath(),ctx.arc(a.locationX-50-this.player.locationX+canvas.width/2+a.hp*(100/a.maxhp)-1,a.locationY-42+5,4,Math.PI/2,3*Math.PI/2,!0),ctx.fill(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.font="18px Arial",ctx.shadowBlur=0,ctx.fillText(a.level+"lv "+a.name,a.locationX-this.player.locationX+canvas.width/2+50-ctx.measureText(a.level+"lv "+a.name).width,a.locationY-52),ctx.strokeText(a.level+"lv "+a.name,a.locationX-this.player.locationX+canvas.width/2+50-ctx.measureText(a.level+"lv "+a.name).width,a.locationY-52),ctx.shadowBlur=20,ctx.drawImage(skeletonSheet.getSheet(a.ImageIndex),a.locationX-32-this.player.locationX+canvas.width/2,a.locationY-32)),ctx.restore()}function drawMap(a){a.locationX-670<0?(mapState="left",shotOffsetX=0,ctx.drawImage(Img.map,0,0,1340,640,0,0,canvas.width,canvas.height)):a.locationX+670>3200?(mapState="right",shotOffsetX=mapWidth-canvas.width,ctx.drawImage(Img.map,3200-canvas.width,0,1340,640,0,0,canvas.width,canvas.height)):(mapState="middle",shotOffsetX=a.locationX-canvas.width/2,ctx.drawImage(Img.map,a.locationX-670,0,1340,640,0,0,canvas.width,canvas.height))}function drawBall(a){ctx.save();var b=ctx.createRadialGradient(60,60,0,60,60,60);b.addColorStop(0,"rgba(255,0,0,1)"),b.addColorStop(.8,"rgba(228,0,0,.9)"),b.addColorStop(1,"rgba(228,0,0,0)"),ctx.shadowBlur=20,ctx.shadowColor="black",ctx.fillStyle="white",ctx.beginPath(),this.player.locationX-670<0?ctx.arc(a.locationX,a.locationY,10,0,2*Math.PI):this.player.locationX+670>3200?ctx.arc(a.locationX-mapWidth+canvas.width,a.locationY,10,0,2*Math.PI):ctx.arc(a.locationX-player.locationX+canvas.width/2,a.locationY,10,0,2*Math.PI),ctx.fill(),ctx.restore()}function dieScreen(){death&&(ctx.save(),ctx.globalAlpha=.2,ctx.fillStyle="#d5deed",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.restore())}function dieEffecte(){try{if(0!=corpseArr.length)try{for(var a=0;a<corpseArr.length;a++)ctx.save(),ctx.shadowBlur=20,ctx.shadowColor=corpseArr[a].color,ctx.fillStyle=corpseArr[a].color,ctx.beginPath(),"left"==mapState?ctx.arc(corpseArr[a].locationX,corpseArr[a].locationY,20,0,2*Math.PI):"right"==mapState?ctx.arc(corpseArr[a].locationX-mapWidth+canvas.width,corpseArr[a].locationY,20,0,2*Math.PI):"middle"==mapState&&ctx.arc(corpseArr[a].locationX-player.locationX+canvas.width/2,corpseArr[a].locationY,20,0,2*Math.PI),ctx.fill(),ctx.restore()}catch(a){}}catch(a){}}function drawMiniMap(){var a=1020,b=520;ctx.save(),ctx.globalAlpha=.5,ctx.fillStyle="rgba(0,0,0,.8)",ctx.fillRect(a,b,310,100),ctx.strokeStyle="black",ctx.beginPath(),ctx.arc(a+player.locationX/10.3,b-(canvas.height-2*player.locationY-600)/10,5,0,2*Math.PI),ctx.fillStyle="lime",ctx.fill();for(var c=0;c<players.length;c++)ctx.beginPath(),ctx.arc(a+players[c].locationX/12,b-(canvas.height-2*players[c].locationY-600)/10,5,0,2*Math.PI),ctx.fillStyle="red",player.team==players[c].team&&(ctx.fillStyle="blue"),ctx.fill();ctx.restore()}function drawTower(){ctx.save(),ctx.font="15px Arial",this.player.locationX-670<0?(ctx.fillStyle="black",ctx.fillText(towers[0],10,300)):this.player.locationX+670>3200&&(ctx.fillStyle="black",ctx.fillText(towers[1],1300,300)),ctx.restore()}function drawScore(){ctx.fillStyle="white",ctx.strokeStyle="black",ctx.font="40px Arial",ctx.strokeText(Math.floor(towers[0])+" : "+Math.floor(towers[1]),canvas.width/2-ctx.measureText(Math.floor(towers[0])+" : "+Math.floor(towers[1])).width/2,50),ctx.fillText(Math.floor(towers[0])+" : "+Math.floor(towers[1]),canvas.width/2-ctx.measureText(Math.floor(towers[0])+" : "+Math.floor(towers[1])).width/2,50)}function drawLeaderBoard(){ctx.save(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.font="20px Arial";for(var a=0;a<topPlayers.length;a++)ctx.strokeText("#"+(a+1)+"  "+topPlayers[a].name+"  "+topPlayers[a].score,12,40+21*a),ctx.fillText("#"+(a+1)+"  "+topPlayers[a].name+"  "+topPlayers[a].score,12,40+21*a);ctx.restore()}function revival(){socket.emit("revival")}function SnowDraw(){ctx.save(),ctx.fillStyle="rgba(255, 255, 255, 0.8)",ctx.beginPath();for(var a=0;a<mp;a++){var b=particles[a];ctx.moveTo(b.x,b.y),ctx.arc(b.x,b.y,b.r,0,2*Math.PI,!0)}ctx.fill(),ctx.restore(),snowUpdate()}function snowUpdate(){angle+=.01;for(var a=0;a<mp;a++){var b=particles[a];b.y+=Math.cos(angle+b.d)+1+b.r/2,b.x+=2*Math.sin(angle),(b.x>W+5||b.x<-5||b.y>H)&&(a%3>0?particles[a]={x:Math.random()*W,y:-2,r:b.r,d:b.d}:Math.sin(angle)>0?particles[a]={x:-2,y:Math.random()*H,r:b.r,d:b.d}:particles[a]={x:W+2,y:Math.random()*H,r:b.r,d:b.d})}}var introAnimationID,W,H,pointX,pointY,shotOffsetX,mapState,player,gameHanddler,socket,loginCanvas=document.getElementById("loginCanvas"),balls_intro=initballs_intro(),date=new Date,time=date.getTime(),mousePos={x:9999,y:9999},mp=25,particles=[],canvas=document.getElementById("myCanvas"),ctx=canvas.getContext("2d"),gameStart=!1,mapWidth=3200,Img={},players=[],ballArr=[],corpseArr=[],death=!1,towers=[],topPlayers=[];W=canvas.width=1340,H=canvas.height=640,Img.map=new Image,Img.map.src="/public/image/map.png",Img.player=new Image,Img.player.src="/public/image/skeleton.png";var skeletonSheet=new spriteSheet(Img.player,9,2,64,64);window.requestAnimFrame=function(a){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.cancelAniFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||function(a){window.clearTimeout(a)}}(),window.onload=function(){window.localStorage&&window.localStorage.nick&&(document.getElementById("nick").value=localStorage.nick)},animate(loginCanvas,balls_intro,time,mousePos);for(var i=0;i<mp;i++)particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:4*Math.random()+1,d:Math.random()*mp});var angle=0,mousePos={x:9999,y:9999};loginCanvas.addEventListener("mousemove",function(a){var b=getMousePos(loginCanvas,a);mousePos.x=b.x,mousePos.y=b.y}),loginCanvas.addEventListener("mouseout",function(a){mousePos.x=9999,mousePos.y=9999});
