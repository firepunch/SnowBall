<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Socket.io</title>

  <!--script src="http://code.jquery.com/jquery-1.10.1.min.js"></script-->
  <script src="/socket.io/socket.io.js"></script>

  <link rel="stylesheet" href="/public/css/style.css">
</head>

<body onload="modalFunction()">
  <div id="myModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>SNOW BALL</h2>
      </div>
      <div class="modal-body">
        <input type="text" placeholder="Nick" id="nickBox"/>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" id="guest">Play as guest</button>
        <button type="button" class="btn btn-warning" data-dismiss="modal" id="login">Login and play</button>
      </div>
    </div>
  </div>

  <p><input type="button" value="massage to server" id="toServer" /></p>
  <canvas id="myCanvas" style="background:  #FAEBD7"></canvas>


  <script>
    // Socket connencting
    var socket = io.connect('http://localhost:3002');    

    function modalFunction() {
      var modal = document.getElementById('myModal');
      var nicBox = document.getElementById('nickBox');
      var guest = document.getElementById('guest');
      var toServer = document.getElementById('toServer');
      
      modal.style.display = 'block';

      // When the user press enter key, play as guest
      nickBox.addEventListener("keyup", function(event) {
        event.preventDefault();
        if (event.which == 13 || event.keyCode == 13){
            //https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Creating_and_triggering_events#Triggering_built-in_events
            // Dispatch/Trigger/Fire the event
            return;
        }
      });      

      guest.addEventListener('mousedown', function() {
        var nickname = nickBox.value;
        socket.emit('nickname', nickname);
        modal.style.display = 'none';
      });

      // message to server
      socket.on('message', function(message) {
        alert('server : ' + message);
      });

      toServer.addEventListener('mousedown', function() {
        socket.emit('message', 'HP decrease');
      });
    }
  </script>

  <script type="text/javascript" src="/public/js/client.js"></script>
  <script type="text/javascript" src="/public/js/game.core.js"></script>
</body>
</html>